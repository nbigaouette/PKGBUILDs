# Maintainer: Nicolas Bigaouette <nbigaouette@gmail.com>

pkgname=intel-opencl-sdk
pkgver=1.1_beta
pkgrel=2
pkgdesc="Intelâ€™s implementation of the OpenCL standard optimized for Intel processors."
arch=('x86_64')
url="http://software.intel.com/en-us/articles/opencl-sdk/"
license=('intel')
depends=('opencl-headers' 'numactl')
provides=('opencl' 'libcl')
install=${pkgname}.install
source=(http://software.intel.com/file/35820/${pkgname/-/_}_${pkgver}_lnx_64.rpm)
md5sums=('63dbb454c8b754b614409c0e116acd5d')

build() {
    # Nothing to do
    return 0
}

package() {
    cp -r ${srcdir}/usr ${pkgdir}/

    # Remove OpenCL headers, conflicting with package 'opencl-headers'
    rm -f ${pkgdir}/usr/include/CL/cl.h
    rm -f ${pkgdir}/usr/include/CL/cl_gl.h
    rm -f ${pkgdir}/usr/include/CL/cl_ext.h
    rm -f ${pkgdir}/usr/include/CL/cl_gl_ext.h
    rm -f ${pkgdir}/usr/include/CL/cl_platform.h
    rm -f ${pkgdir}/usr/include/CL/opencl.h

    mkdir -p ${pkgdir}/etc
    mv ${pkgdir}/usr/lib64/OpenCL ${pkgdir}/etc/OpenCL

    # Fix path
    #sed -e "s|.*|/etc/OpenCL/vendors/intel/libintelocl.so|g" -i ${pkgdir}/etc/OpenCL/vendors/intel/intelocl64.icd
    echo "/etc/OpenCL/vendors/intel/libintelocl.so" > ${pkgdir}/etc/OpenCL/vendors/intel/intelocl64.icd

    mkdir -p ${pkgdir}/etc/ld.so.conf.d
    echo "/etc/OpenCL/vendors/intel/" > ${pkgdir}/etc/ld.so.conf.d/intel-opencl-sdk.conf
}
