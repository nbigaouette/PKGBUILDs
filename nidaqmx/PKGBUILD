# Maintainer: Dirk dirk@lotje.com

pkgname=nidaqmxbase
pkgver=3.5.0
pkgrel=1
pkgdesc="NI DAQmx Base"
url="http://ni.com/labview"
arch=('i686' 'x86_64')
license=('custom:National Instruments software license agreement')
makedepends=('rpmextract')
depends=('labview82-rte')
# Extra dependencies
if [[ "${CARCH}" = "x86_64" ]]; then
    depends=(${depends[@]} 'lib32-glib2')
else
    depends=(${depends[@]} 'glib2')
fi
source=($pkgname-board-support-$pkgver-f1.i386.rpm
        #$pkgname-cinterface-$pkgver-f1.i386.rpm
        $pkgname-common-$pkgver-f1.i386.rpm
        $pkgname-labview2009-VIs-$pkgver-f1.i386.rpm
        $pkgname-labview2010-VIs-$pkgver-f1.i386.rpm
        $pkgname-labview2011-VIs-$pkgver-f1.i386.rpm
        $pkgname-labview86-VIs-$pkgver-f1.i386.rpm
        $pkgname-usb-support-$pkgver-f1.i386.rpm)

# The mdsums are generated by running makepkg -g
md5sums=('11cfd306fe899ae89168724f651f5898'
         #'734d0ab1d94175f4112c52ebcc07cd40'
         'e7adca00d6530787dfc0c80034969e11'
         '9bce3c2ce3c278b52afff836f23cd08e'
         'bd55f6421f042751aec6f3b9fadbccc1'
         'd14ba1f23e43f813b643115e52fb67ec'
         '2c1813d328c690061616a489545de83c'
         '8d89ddc6ae029af1c81caa3e8fbb19ce')
build() {
# extract all rpms
  cd ${srcdir}
    for rpmfile in ${srcdir}/*.rpm
    do
        rpmextract.sh ${rpmfile}
    done
# put resulting files in the correct location
  cd ${pkgdir}
  mkdir -p ${pkgdir}/opt
  cp -a ${srcdir}/usr/local/natinst ${pkgdir}/opt/
# make symbolic links
  _udevsrcdir=/opt/natinst/nidaqmxbase/etc/hotplug/usb
  # udev/rules.d
  mkdir -p ${pkgdir}/etc/udev/rules.d
  cd ${pkgdir}/etc/udev/rules.d
  ln -s ${_udevsrcdir}/nimxb_600x.rules
  ln -s ${_udevsrcdir}/nimxb_650x.rules
  ln -s ${_udevsrcdir}/nimxb_9162.rules
  ln -s ${_udevsrcdir}/nimxb_92xx.rules
  ln -s ${_udevsrcdir}/nimxb_621xdevice.rules
  ln -s ${_udevsrcdir}/nimxb_621xloader.rules
  # udev/agents.d
  mkdir -p ${pkgdir}/etc/udev/agents.d/usb
  cd ${pkgdir}/etc/udev/agents.d/usb
  ln -s ${_udevsrcdir}/nimxb_usb600x
  ln -s ${_udevsrcdir}/nimxb_usb650x
  ln -s ${_udevsrcdir}/nimxb_usb9162
  ln -s ${_udevsrcdir}/nimxb_usb92xx
  ln -s ${_udevsrcdir}/nimxb_621xdevice
  ln -s ${_udevsrcdir}/nimxb_621xloader
  # /usr/bin
  _nidaqmxbindir=/opt/natinst/nidaqmxbase/bin
  mkdir -p ${pkgdir}/usr/bin
  cd ${pkgdir}/usr/bin
  ln -s ${_nidaqmxbindir}/lsdaq
  ln -s ${_nidaqmxbindir}/mxbaseconfig
  ln -s ${_nidaqmxbindir}/nidatalogger
  ln -s ${_nidaqmxbindir}/niusb9162dlfw
  # /etc/natinst
  mkdir -p ${pkgdir}/etc/natinst
  cd ${pkgdir}/etc/natinst
  ln -s /opt/natinst/nidaqmxbase nidaqmxbase

  # /usr/lib
  mkdir -p ${pkgdir}/usr/lib
  cd ${pkgdir}/usr/lib
  ln -s lib67xx.so.2 lib67xx.so
  ln -s lib67xx.so.2.1.0 lib67xx.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/lib67xx.so.2.1.0
  ln -s libdaqmxbase_listdevices_so.so.3 libdaqmxbase_listdevices_so.so
  ln -s libdaqmxbase_listdevices_so.so.3.5.0 libdaqmxbase_listdevices_so.so.3
  ln -s /opt/natinst/nidaqmxbase/lib/libdaqmxbase_listdevices_so.so.3.5.0
  ln -s libDIO96.so.2 libDIO96.so
  ln -s libDIO96.so.2.1.0 libDIO96.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/libDIO96.so.2.1.0
  ln -s libESeries.so.2 libESeries.so
  ln -s libESeries.so.2.1.0 libESeries.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/libESeries.so.2.1.0
  ln -s liblsdaqlv.so.3 liblsdaqlv.so
  ln -s liblsdaqlv.so.3.5.0 liblsdaqlv.so.3
  ln -s /opt/natinst/nidaqmxbase/lib/liblsdaqlv.so.3.5.0
  ln -s libmiteDma.so.2 libmiteDma.so
  ln -s libmiteDma.so.2.1.0 libmiteDma.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/libmiteDma.so.2.1.0
  ln -s libMSeries.so.2 libMSeries.so
  ln -s libMSeries.so.2.1.0 libMSeries.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/libMSeries.so.2.1.0
  ln -s libnidaqmxbaselv.so.3 libnidaqmxbaselv.so
  ln -s libnidaqmxbaselv.so.3.5.0 libnidaqmxbaselv.so.3
  ln -s /opt/natinst/nidaqmxbase/lib/libnidaqmxbaselv.so.3.5.0
  ln -s libnidaqmxbase.so.3 libnidaqmxbase.so
  ln -s libnidaqmxbase.so.3.5.0 libnidaqmxbase.so.3
  ln -s /opt/natinst/nidaqmxbase/lib/libnidaqmxbase.so.3.5.0
  ln -s libniusb9162.so.3 libniusb9162.so
  ln -s libniusb9162.so.3.5.0 libniusb9162.so.3
  ln -s /opt/natinst/nidaqmxbase/lib/libniusb9162.so.3.5.0
  ln -s libSSeries.so.2 libSSeries.so
  ln -s libSSeries.so.2.1.0 libSSeries.so.2
  ln -s /opt/natinst/nidaqmxbase/lib/libSSeries.so.2.1.0
  ln -s libUSB-92xx.so.1 libUSB-92xx.so
  ln -s libUSB-92xx.so.1.4.0 libUSB-92xx.so.1
  ln -s /opt/natinst/nidaqmxbase/lib/libUSB-92xx.so.1.4.0
}
